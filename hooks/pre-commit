#!/usr/bin/env sh

fail="$(mktemp)"

# Update data files
echo "Update data files"
{ npm run update-data || echo > "$fail"; }
git add src/data/*.json

# Update README.md:
echo "Update README.md"
{ npm run update-readme || echo > "$fail"; }
git add README.md

# Package action to dist:
echo "Package action to dist"
{ npm run all || echo > "$fail"; }
git add dist/*

# Check files with pre-commit
echo "Run pre-commit"
{ pre-commit run --all-files || echo > "$fail"; }

# Check if any of the previous commands failed:
if [ ! -s "$fail" ]
then
    rm "$fail"
    exit 0
else
    rm "$fail"
    exit 1
fi
